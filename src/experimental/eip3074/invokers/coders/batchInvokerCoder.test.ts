import { expect, test } from 'vitest'
import { BatchInvoker } from '../../../../../test/contracts/generated.js'
import { anvil3074 } from '../../../../../test/src/anvil.js'
import { deploy } from '../../../../../test/src/utils.js'
import { parseEther } from '../../../../utils/index.js'
import { batchInvokerCoder } from './batchInvokerCoder.js'

const client = anvil3074.getClient()

test('default', async () => {
  const { contractAddress: invokerAddress } = await deploy(client, {
    abi: BatchInvoker.abi,
    bytecode: BatchInvoker.bytecode.object,
  })

  const coder = batchInvokerCoder()
  expect(
    await coder.toExecData(
      [
        {
          to: '0xd2135CfB216b74109775236E36d4b433F1DF507B',
          data: '0xdeadbeef',
          value: parseEther('1'),
        },
        { to: '0xd2135CfB216b74109775236E36d4b433F1DF507B' },
        {
          to: '0xd2135CfB216b74109775236E36d4b433F1DF507B',
          value: parseEther('1'),
        },
        {
          to: '0xd2135CfB216b74109775236E36d4b433F1DF507B',
          data: '0xdeadbeef',
        },
      ],
      {
        authority: '0x0000000000000000000000000000000000000000',
        client,
        invokerAddress: invokerAddress!,
      },
    ),
  ).toMatchInlineSnapshot(
    `"0x00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000040000000000000000000000000000000000000000000000000000000000000015c02d2135cfb216b74109775236e36d4b433f1df507b0000000000000000000000000000000000000000000000000de0b6b3a76400000000000000000000000000000000000000000000000000000000000000000004deadbeef02d2135cfb216b74109775236e36d4b433f1df507b0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002d2135cfb216b74109775236e36d4b433f1df507b0000000000000000000000000000000000000000000000000de0b6b3a7640000000000000000000000000000000000000000000000000000000000000000000002d2135cfb216b74109775236e36d4b433f1df507b00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000004deadbeef00000000"`,
  )
})
